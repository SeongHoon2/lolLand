<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.lolland.dao.AuctionDao">

  <select id="getAuctionMax" resultType="map" parameterType ="map">
  SELECT IFNULL(MAX(AUC_SEQ)+1, 1) AS MAX_CNT
    FROM AUC_TARGET
   WHERE AUC_CD = #{seq_params}
  </select>
  
  <select id="getAucTargetListA" resultType="map">
SELECT 
    A.SEQ,
    A.AUC_CD,
    A.AUC_SEQ,
    A.NO,
    A.NICK,
    A.TIER,
    A.MROLE,
    A.SROLE,
    A.POINT,
    A.LEADERFLG,
    DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
    A.RANDOMCODE,
    ROW_NUMBER() OVER (
        ORDER BY A.LEADERFLG DESC,
            CASE A.TIER
                WHEN 'C'  THEN 1
                WHEN 'GM' THEN 2
                WHEN 'M'  THEN 3
                WHEN 'D'  THEN 4
                WHEN 'E'  THEN 5
                WHEN 'P'  THEN 6
                WHEN 'G'  THEN 7
                WHEN 'S'  THEN 8
                WHEN 'B'  THEN 9
                ELSE 10
            END,
            A.NICK DESC
    ) AS ROW_RNK
FROM AUC_TARGET A
WHERE A.AUC_CD = 1
  AND A.USE_YN = 'Y'
  AND A.AUC_SEQ = (
       SELECT MAX(AUC_SEQ)
         FROM AUC_TARGET
        WHERE AUC_CD = 1
          AND USE_YN = 'Y'
  )
ORDER BY A.LEADERFLG DESC,
    CASE A.TIER
        WHEN 'C'  THEN 1
        WHEN 'GM' THEN 2
        WHEN 'M'  THEN 3
        WHEN 'D'  THEN 4
        WHEN 'E'  THEN 5
        WHEN 'P'  THEN 6
        WHEN 'G'  THEN 7
        WHEN 'S'  THEN 8
        WHEN 'B'  THEN 9
        ELSE 10
    END,
    A.NICK DESC
  </select>
  
  <select id="getAucTargetListB" resultType="map">
SELECT 
    A.SEQ,
    A.AUC_CD,
    A.AUC_SEQ,
    A.NO,
    A.NICK,
    A.TIER,
    A.MROLE,
    A.SROLE,
    A.LEADERFLG,
    A.POINT,
    DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
    A.RANDOMCODE,
    ROW_NUMBER() OVER (
        ORDER BY A.LEADERFLG DESC,
            CASE A.TIER
                WHEN 'C'  THEN 1
                WHEN 'GM' THEN 2
                WHEN 'M'  THEN 3
                WHEN 'D'  THEN 4
                WHEN 'E'  THEN 5
                WHEN 'P'  THEN 6
                WHEN 'G'  THEN 7
                WHEN 'S'  THEN 8
                WHEN 'B'  THEN 9
                ELSE 10
            END,
            A.NICK DESC
    ) AS ROW_RNK
FROM AUC_TARGET A
WHERE A.AUC_CD = 2
  AND A.USE_YN = 'Y'
  AND A.AUC_SEQ = (
       SELECT MAX(AUC_SEQ)
         FROM AUC_TARGET
        WHERE AUC_CD = 2
          AND USE_YN = 'Y'
  )
ORDER BY A.LEADERFLG DESC,
    CASE A.TIER
        WHEN 'C'  THEN 1
        WHEN 'GM' THEN 2
        WHEN 'M'  THEN 3
        WHEN 'D'  THEN 4
        WHEN 'E'  THEN 5
        WHEN 'P'  THEN 6
        WHEN 'G'  THEN 7
        WHEN 'S'  THEN 8
        WHEN 'B'  THEN 9
        ELSE 10
    END,
    A.NICK DESC
  </select>
  
</mapper>
